{% include "demo/header.html" %}
			

			<!-- 这里才是内容的真正开始 -->
			<div id="content" class="span10">
			<!-- content starts -->
			

			<div>
				<ul class="breadcrumb">
					<li>
						<a href="#">编辑比赛项目</a>
					</li>
				</ul>
			</div>

			
			<div class="row-fluid">
			<!-- 这里是选择项目的面板  span4-->
				<div class="box span4">
					<div class="box-header well" data-original-title>
						<h2><i class="icon-edit"></i> 选择比赛项目</h2>
						<!-- 这三个icon用于各种“花俏”配置 -->
						<!-- <div class="box-icon">
							<a href="#" class="btn btn-setting btn-round"><i class="icon-cog"></i></a>
							<a href="#" class="btn btn-minimize btn-round"><i class="icon-chevron-up"></i></a>
							<a href="#" class="btn btn-close btn-round"><i class="icon-remove"></i></a>
						</div> -->
					</div>
					<div class="box-content">
						<form class="form-horizontal">
						  <fieldset>
							<!-- <legend>比赛项目</legend> -->
							<div class="control-group">
							<!-- 这个select的span12是相对于包含它的div的 -->
							<select multiple class="span12" id="competitions" size="30">
							  {% if latest_sport_list %}
								{% for sport in latest_sport_list %}
									<option value="{{sport.sport_name}}">{{sport.sport_name}}</option>
								{% endfor %}
							  {% endif %}
							</select>
							<div>
								<button style="float:right;" id="delete_competition" onclick="return false;">-</button>
								<button style="float:right;" id="add_competition"  onclick="return false;">+</button>
							</div>
							</div>
							<!-- <div class="form-actions">
							  <button type="submit" class="btn btn-primary">确认修改</button>
							  <button type="reset" class="btn">撤销修改</button>
							</div> -->
						  </fieldset>
						</form>   

					</div>
				</div><!--/span-->

				<!-- 这里开始是编辑项目的具体数据面板 span8-->
				<div class="box span8">
					<div class="box-header well" data-original-title>
						<h2 id="right_title"><i class="icon-edit"></i> 选择比赛项目</h2>
					</div>
						<div class="box-content">
						<form class="form-horizontal">
						  <fieldset>
							<div class="control-group">
							  <label class="control-label" for="name">项目名称</label>
							  <div class="controls">
								<input type="text" class="input-xlarge" id="name" value="" placeholder="400米|800米|...">
							  </div>
							</div>

							<div class="control-group">
							  <label class="control-label" for="sort">成绩排序方式</label>
							  <div class="controls">
								  <select name="sort" id="sort">
								  	<option value="1">由大到小排序（如跳高）</option>
								  	<option value="2">由小到大排序（如跑步）</option>
								  </select>
						 	  </div>
							</div>
		
							<div class="control-group">
							  <label class="control-label" for="format">成绩统计格式</label>
							  <div class="controls">
								  <select name="format" id="format">
								  	<option value="0">xx 米 xxx</option>
								  	<option value="1">xx 分 xx 秒 xx</option>
								  </select>
						 	  </div>
							</div>

							<div class="control-group">
							  <label class="control-label" for="college_rec">院最高纪录</label>
							  <div class="controls" >
								  <input name="college_rec" id="college_rec"  type="text" class="input-xlarge" value="" placeholder="" >
						 	  </div>
							</div>

							<div class="control-group">
							  <label class="control-label" for="campus_rec">校最高纪录</label>
							  <div class="controls" >
								  <input name="campus_rec" id="campus_rec" type="text" class="input-xlarge" value="" placeholder="" >
						 	  </div>
							</div>

							<div class="control-group">
							  <label class="control-label" for="score_add">加分规则</label>
							  <div class="controls" >
								  <input name="score_add" id="score_add" type="text" class="input-xlarge" value="" placeholder="20|16|14|12|10|8|6|4" >
						 	  </div>
							</div>

							<div class="control-group">
							  <label class="control-label" for="group_num">比赛分组数目</label>
							  <div class="controls" >
								  <input name="group_num" id="group_num" type="text" class="input-xlarge" value="" placeholder="4" >
						 	  </div>
							</div>

							<div class="control-group">
							  <label class="control-label" for="preliminary">是否有预赛</label>
							  <div class="controls">
								  <select name="preliminary" id="preliminary">
								  	<option value="0">无</option>
								  	<option value="1">有</option>
								  </select>
						 	  </div>
							</div>

							<div class="control-group">
							  <label class="control-label" for="rise">晋级人数</label>
							  <div class="controls" >
								  <input name="rise" id="rise" type="text" class="input-xlarge" value="" placeholder="4" >
						 	  </div>
							</div>

							<div class="form-actions" class="span12">
							  <button class="btn btn-primary" id="adding" onclick="return false;">增添</button>
							  <button class="btn btn-primary" id="changing" onclick="return false;">修改</button>
							  <button type="reset" class="btn" id="reset" onclick="return false;">重置表单</button>
							</div>
						  </fieldset>
						</form>   

					</div>
				</div><!--/span-->

			</div><!--/row-->

			

			
			
			<!-- content ends -->
			</div><!--/#content.span10-->
				</div><!--/fluid-row-->
				
		<hr>

		<div class="modal hide fade" id="myModal">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">×</button>
				<h3>Settings</h3>
			</div>
			<div class="modal-body">
				<p>Here settings can be configured...</p>
			</div>
			<div class="modal-footer">
				<a href="#" class="btn" data-dismiss="modal">Close</a>
				<a href="#" class="btn btn-primary">Save changes</a>
			</div>
		</div>

		<input type="hidden" id="option_value" value="0">
		<input type="hidden" id="post_url" value="">
		<!-- 两个hidden input用来做setting。。 -->
		<footer>
			<p class="pull-left">&copy; <a href="http://usman.it" target="_blank">Muhammad Usman</a> 2012</p>
			<p class="pull-right">Powered by: <a href="http://usman.it/free-responsive-admin-template">Charisma</a></p>
		</footer>
		
	</div><!--/.fluid-container-->

	<!-- external javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->

	<!-- jQuery -->
	{% load staticfiles %}
	<script src="{% static 'js/jquery-1.7.2.min.js'%}"></script>
	<!-- jQuery UI -->
	<script src="{% static 'js/jquery-ui-1.8.21.custom.min.js'%}"></script>
	<!-- transition / effect library -->
	<script src="{% static 'js/bootstrap-transition.js'%}"></script>
	<!-- alert enhancer library -->
	<script src="{% static 'js/bootstrap-alert.js'%}"></script>
	<!-- modal / dialog library -->
	<script src="{% static 'js/bootstrap-modal.js'%}"></script>
	<!-- custom dropdown library -->
	<script src="{% static 'js/bootstrap-dropdown.js'%}"></script>
	<!-- scrolspy library -->
	<script src="{% static 'js/bootstrap-scrollspy.js'%}"></script>
	<!-- library for creating tabs -->
	<script src="{% static 'js/bootstrap-tab.js'%}"></script>
	<!-- library for advanced tooltip -->
	<script src="{% static 'js/bootstrap-tooltip.js'%}"></script>
	<!-- popover effect library -->
	<script src="{% static 'js/bootstrap-popover.js'%}"></script>
	<!-- button enhancer library -->
	<script src="{% static 'js/bootstrap-button.js'%}"></script>
	<!-- accordion library (optional, not used in demo) -->
	<script src="{% static 'js/bootstrap-collapse.js'%}"></script>
	<!-- carousel slideshow library (optional, not used in demo) -->
	<script src="{% static 'js/bootstrap-carousel.js'%}"></script>
	<!-- autocomplete library -->
	<script src="{% static 'js/bootstrap-typeahead.js'%}"></script>
	<!-- tour library -->
	<script src="{% static 'js/bootstrap-tour.js'%}"></script>
	<!-- library for cookie management -->
	<script src="{% static 'js/jquery.cookie.js'%}"></script>
	<!-- calander plugin -->
	<script src="{% static 'js/fullcalendar.min.js'%}"></script>
	<!-- data table plugin -->
	<script src="{% static 'js/jquery.dataTables.min.js'%}"></script>

	<!-- chart libraries start -->
	<script src="{% static 'js/excanvas.js'%}"></script>
	<script src="{% static 'js/jquery.flot.min.js'%}"></script>
	<script src="{% static 'js/jquery.flot.pie.min.js'%}"></script>
	<script src="{% static 'js/jquery.flot.stack.js'%}"></script>
	<script src="{% static 'js/jquery.flot.resize.min.js'%}"></script>
	<!-- chart libraries end -->

	<!-- select or dropdown enhancer -->
	<script src="{% static 'js/jquery.chosen.min.js'%}"></script>
	<!-- checkbox, radio, and file input styler -->
	<script src="{% static 'js/jquery.uniform.min.js'%}"></script>
	<!-- plugin for gallery image view -->
	<script src="{% static 'js/jquery.colorbox.min.js'%}"></script>
	<!-- rich text editor library -->
	<script src="{% static 'js/jquery.cleditor.min.js'%}"></script>
	<!-- notification plugin -->
	<script src="{% static 'js/jquery.noty.js'%}"></script>
	<!-- file manager library -->
	<script src="{% static 'js/jquery.elfinder.min.js'%}"></script>
	<!-- star rating plugin -->
	<script src="{% static 'js/jquery.raty.min.js'%}"></script>
	<!-- for iOS style toggle switch -->
	<script src="{% static 'js/jquery.iphone.toggle.js'%}"></script>
	<!-- autogrowing textarea plugin -->
	<script src="{% static 'js/jquery.autogrow-textarea.js'%}"></script>
	<!-- multiple file upload plugin -->
	<script src="{% static 'js/jquery.uploadify-3.1.min.js'%}"></script>
	<!-- history.js for cross-browser state change on ajax -->
	<script src="{% static 'js/jquery.history.js'%}"></script>
	<!-- application script for Charisma demo -->
	<script src="{% static 'js/charisma.js'%}"></script>
	<script>
	
	// post_url默认为空
	// option_value作为全局的值，来作为修改后提交的对应凭证
		$(document).ready(function(){	
		  // $("#competitions option").click(function(){
		  	$("#competitions").delegate("option","click",function(){
		  	// alert("click");
		  	// 如果是按option的话就是修改和编辑
		  	// 这里需要更改全局post_url
		  	var option_value = this.value;
		  	var post_url = "{% url 'demo:view_sport' %}"
		  	$("#right_title").html("修改项目");
		  	// $("#name").attr("disabled","disabled");
		  $.ajax({
			    type: 'POST',
			    url: post_url ,
			    data: {
			    	name : option_value,
			    } ,
			    cache:false,
			    success: function(data){     
			       $("#name").attr("value",data.sport_name);
			       $("#sort").attr("value",data.sort);
			       $("#format").attr("value",data.format);
			       $("#college_rec").attr("value",data.college_rec);
			       $("#campus_rec").attr("value",data.campus_rec);
			       $("#score_add").attr("value",data.score_add);
			       $("#group_num").attr("value",data.group_num);
			       $("#preliminary").attr("value",data.preliminary);
			       $("#rise").attr("value",data.rise); 
			       $("#post_url").attr("value","{% url 'demo:change_sport' %}");
			       $("#name").attr("disabled","disabled");
			    } ,
			    error:function (XMLHttpRequest, textStatus, errorThrown) {
			  // 通常情况下textStatus和errorThown只有其中一个有值 
			  alert(errorThrown); // the options for this ajax request
			},
		   dataType: "json"
			});

		  });
		// 上面是按option的反应
		// 这个add_competition是指点击那个"+"号之后的反应
		// 这里需要更改全局的post_url
			$("#add_competition,#reset").click(function(){
				// post_url = "{% url 'demo:add_sport' %}";
				// 因为修改和增加在同一个按钮实现，所以要用post_url来区别两个url
				// option_value = ""; 
				// 清空option值，防止无意中按了保存之类的，虽然post_url变了
				// 只是清空右方表格的值
				// $("#right_title").html("新增项目");
				$("#name").removeAttr("disabled"); 
				$("#name").attr("value","");
			    $("#sort").attr("value","");
			    $("#format").attr("value","");
			    $("#college_rec").attr("value","");
			    $("#campus_rec").attr("value","");
			    $("#score_add").attr("value","");
			    $("#group_num").attr("value","");
			    $("#preliminary").attr("value","");
			    $("#rise").attr("value","");


			});
			$("#adding").click(function(){
					name = $("#name").attr("value");
				    sort = $("#sort").attr("value");
				    format = $("#format").attr("value");
				    college_rec = $("#college_rec").attr("value");
				    campus_rec = $("#campus_rec").attr("value");
				    score_add = $("#score_add").attr("value");
				    group_num = $("#group_num").attr("value");
				    preliminary = $("#preliminary").attr("value");
				    rise = $("#rise").attr("value");
				    $("#name").removeAttr("disabled"); 
				if (!name||!sort||!format||!college_rec||!campus_rec||!score_add||!group_num||!preliminary||!rise)
				{
					alert("尚有信息未填写，请补充完毕再点击");
					return false;
				}

					// 如果是增加的话,ajax到增加
					$.ajax({
					    type: 'POST',
					    url: "{% url 'demo:add_sport' %}" ,
					    data: {
					    	name : name,
					    	sort : sort,
					    	format : format,
					    	college_rec:college_rec,
					    	campus_rec:campus_rec,
					    	score_add:score_add,
					    	group_num:group_num,
					    	preliminary:preliminary,
					    	rise:rise,
					    } ,
					    cache:false,
					    success: function(data){    
					       // 要立即在option里面显示这个option
					       if (data == "添加成功")
					       {
					       		$("#competitions").append("<option value=\"" + name + "\">" + name + "</option>");
					       }
					       // 清空右边
					       $("#name").attr("value","");
						    $("#sort").attr("value","");
						    $("#format").attr("value","");
						    $("#college_rec").attr("value","");
						    $("#campus_rec").attr("value","");
						    $("#score_add").attr("value","");
						    $("#group_num").attr("value","");
						    $("#preliminary").attr("value","");
						    $("#rise").attr("value","");
						    alert(data); 

					    } ,
					    error:function (XMLHttpRequest, textStatus, errorThrown) {
					  // 通常情况下textStatus和errorThown只有其中一个有值 
					  alert(errorThrown); // the options for this ajax request
					},
				   // dataType: "json"
				   // 把dataType注释掉系统反而会自动识别
					});
			});


			// 点了修改button之后的反应				
			$("#changing").click(function(){
				name = $("#name").attr("value");
				sort = $("#sort").attr("value");
				format = $("#format").attr("value");
				college_rec = $("#college_rec").attr("value");
				campus_rec = $("#campus_rec").attr("value");
				score_add = $("#score_add").attr("value");
				group_num = $("#group_num").attr("value");
				preliminary = $("#preliminary").attr("value");
				rise = $("#rise").attr("value");

				if (!name||!sort||!format||!college_rec||!campus_rec||!score_add||!group_num||!preliminary||!rise)
				{
					alert("尚有信息未填写，请补充完毕再点击");
					return false;
				}

				$.ajax({
					    type: 'POST',
					    url: "{% url 'demo:change_sport' %}" ,
					    data: {
					    	name : name,
					    	sort : sort,
					    	format : format,
					    	college_rec:college_rec,
					    	campus_rec:campus_rec,
					    	score_add:score_add,
					    	group_num:group_num,
					    	preliminary:preliminary,
					    	rise:rise,
					    } ,
					    cache:false,
					    success: function(data){    
					       // 要立即在option里面显示这个option
					       // 清空右边
					       	$("#name").attr("value","");
						    $("#sort").attr("value","");
						    $("#format").attr("value","");
						    $("#college_rec").attr("value","");
						    $("#campus_rec").attr("value","");
						    $("#score_add").attr("value","");
						    $("#group_num").attr("value","");
						    $("#preliminary").attr("value","");
						    $("#rise").attr("value","");
						    $("#name").removeAttr("disabled"); 
						    alert(data);

					    } ,
					    error:function (XMLHttpRequest, textStatus, errorThrown) {
					  // 通常情况下textStatus和errorThown只有其中一个有值 
					  alert(errorThrown); // the options for this ajax request
					},
				   // dataType: "json"
				   // 把dataType注释掉系统反而会自动识别
					});

			})


			// 下面是点了删除该运动（点击了"-"之后）之后的反应
			$("#delete_competition").click(function(){
				// 首先选中才能按删除，所以按删除之前有点已经ajax显示了一次
				// 并且option_value有值
				// var option_value = $("#option_value").attr("value");
				var option_value = $("#competitions option:selected").attr("value");
				var post_url = "{% url 'demo:del_sport' %}";
				if (option_value == "")
				{
					alert("请点选你要删除的运动项目,再按删除键!");
					return;
				}
				
				
				// var confirmation = confirm(确定删除该体育项目?);
				if (!confirm("确定删除该体育项目?"))
				{
					return false;
				}

				$.ajax({
			    type: 'POST',
			    url: post_url , // url for deleting sport
			    data: {
			    	name : option_value,
			    } ,
			    cache:false,
			    success: function(data){     
			       // 清空右方表格的值
					$("#name").attr("value","");
				    $("#sort").attr("value","");
				    $("#format").attr("value","");
				    $("#college_rec").attr("value","");
				    $("#campus_rec").attr("value","");
				    $("#score_add").attr("value","");
				    $("#group_num").attr("value","");
				    $("#preliminary").attr("value","");
				    $("#rise").attr("value",""); 
				   	$("#competitions option[value="+option_value+"]").remove(); 
				   	$("#name").removeAttr("disabled"); 
				   	//直接从DOM树中去除，下次刷新的时候就不见了
				    alert("成功删除!");

			    } ,
			    error:function (XMLHttpRequest, textStatus, errorThrown) {
			  // 通常情况下textStatus和errorThown只有其中一个有值 
			  alert(errorThrown); // the options for this ajax request
			},
		   // dataType: "json"
			});
				


			});

		});
	</script>
	
		
</body>
</html>
